
  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.2)

2026-02-05 16:53:55.429 [main] [] INFO  c.f.p.PaymentServiceApplication - Starting PaymentServiceApplication using Java 21.0.2 with PID 23848 (C:\Users\C15447B\Documents\personal\Food delivery application\services\payment-service\target\payment-service-1.0.0-SNAPSHOT.jar started by C15447B in C:\Users\C15447B\Documents\personal\Food delivery application)
2026-02-05 16:53:55.452 [main] [] DEBUG c.f.p.PaymentServiceApplication - Running with Spring Boot v3.2.2, Spring v6.1.3
2026-02-05 16:53:55.455 [main] [] INFO  c.f.p.PaymentServiceApplication - The following 1 profile is active: "local"
2026-02-05 16:53:59.563 [main] [] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2026-02-05 16:53:59.567 [main] [] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-02-05 16:54:00.186 [main] [] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 605 ms. Found 1 JPA repository interface.
2026-02-05 16:54:01.310 [main] [] INFO  o.s.cloud.context.scope.GenericScope - BeanFactory id=ce8c8d7d-9f2a-334f-9d47-8c395a129abc
2026-02-05 16:54:02.664 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration$RetryInterceptorAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration$RetryInterceptorAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). The currently created BeanPostProcessor [lbRestClientPostProcessor] is declared through a non-static factory method on that class; consider declaring it as static instead.
2026-02-05 16:54:02.688 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.loadbalancer.config.BlockingLoadBalancerClientAutoConfiguration' of type [org.springframework.cloud.loadbalancer.config.BlockingLoadBalancerClientAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.704 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.loadbalancer.config.LoadBalancerAutoConfiguration' of type [org.springframework.cloud.loadbalancer.config.LoadBalancerAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.741 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration' of type [org.springframework.cloud.commons.config.CommonsConfigAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.753 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.767 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientsDefaultsMappingsProvider' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerDefaultMappingsProviderAutoConfiguration$$Lambda/0x000002378956d000] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.791 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'defaultsBindHandlerAdvisor' of type [org.springframework.cloud.commons.config.DefaultsBindHandlerAdvisor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.820 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'spring.cloud.loadbalancer-org.springframework.cloud.client.loadbalancer.LoadBalancerClientsProperties' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerClientsProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.865 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'default.org.springframework.cloud.loadbalancer.config.LoadBalancerAutoConfiguration.LoadBalancerClientSpecification' of type [org.springframework.cloud.loadbalancer.annotation.LoadBalancerClientSpecification] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.874 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'default.org.springframework.cloud.loadbalancer.config.BlockingLoadBalancerClientAutoConfiguration.LoadBalancerClientSpecification' of type [org.springframework.cloud.loadbalancer.annotation.LoadBalancerClientSpecification] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.878 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerClientFactory' of type [org.springframework.cloud.loadbalancer.support.LoadBalancerClientFactory] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.911 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'blockingLoadBalancerClient' of type [org.springframework.cloud.loadbalancer.blocking.client.BlockingLoadBalancerClient] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.939 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerServiceInstanceCookieTransformer' of type [org.springframework.cloud.loadbalancer.core.LoadBalancerServiceInstanceCookieTransformer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.948 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'xForwarderHeadersTransformer' of type [org.springframework.cloud.loadbalancer.blocking.XForwardedHeadersTransformer] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.955 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerAutoConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.965 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerRequestFactory' of type [org.springframework.cloud.client.loadbalancer.LoadBalancerRequestFactory] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.971 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'org.springframework.cloud.loadbalancer.config.BlockingLoadBalancerClientAutoConfiguration$BlockingLoadBalancerRetryConfig' of type [org.springframework.cloud.loadbalancer.config.BlockingLoadBalancerClientAutoConfiguration$BlockingLoadBalancerRetryConfig$$SpringCGLIB$$0] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:02.989 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancedRetryFactory' of type [org.springframework.cloud.loadbalancer.blocking.retry.BlockingLoadBalancedRetryFactory] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:03.012 [main] [] WARN  o.s.c.s.PostProcessorRegistrationDelegate$BeanPostProcessorChecker - Bean 'loadBalancerInterceptor' of type [org.springframework.cloud.client.loadbalancer.RetryLoadBalancerInterceptor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying). Is this bean getting eagerly injected into a currently created BeanPostProcessor [lbRestClientPostProcessor]? Check the corresponding BeanPostProcessor declaration and its dependencies.
2026-02-05 16:54:03.842 [main] [] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8082 (http)
2026-02-05 16:54:03.869 [main] [] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2026-02-05 16:54:03.869 [main] [] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.18]
2026-02-05 16:54:04.014 [main] [] INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2026-02-05 16:54:04.017 [main] [] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 8084 ms
2026-02-05 16:54:05.910 [main] [] INFO  com.zaxxer.hikari.HikariDataSource - PaymentServiceHikariPool - Starting...
2026-02-05 16:54:06.471 [main] [] INFO  com.zaxxer.hikari.pool.HikariPool - PaymentServiceHikariPool - Added connection conn0: url=jdbc:h2:mem:payment_db user=SA
2026-02-05 16:54:06.474 [main] [] INFO  com.zaxxer.hikari.HikariDataSource - PaymentServiceHikariPool - Start completed.
2026-02-05 16:54:06.493 [main] [] INFO  o.s.b.a.h.H2ConsoleAutoConfiguration - H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:payment_db'
2026-02-05 16:54:07.324 [main] [] INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2026-02-05 16:54:07.448 [main] [] INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.1.Final
2026-02-05 16:54:07.543 [main] [] INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2026-02-05 16:54:08.283 [main] [] INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2026-02-05 16:54:08.365 [main] [] WARN  org.hibernate.orm.deprecation - HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-02-05 16:54:09.414 [main] [] INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-02-05 16:54:09.435 [main] [] DEBUG org.hibernate.SQL - 
    drop table if exists payments cascade 
Hibernate: 
    drop table if exists payments cascade 
2026-02-05 16:54:09.447 [main] [] DEBUG org.hibernate.SQL - 
    create table payments (
        amount numeric(12,2) not null,
        attempt_count integer,
        card_last_four varchar(4),
        currency varchar(3) not null,
        refund_amount numeric(12,2),
        completed_at timestamp(6) with time zone,
        created_at timestamp(6) with time zone not null,
        processed_at timestamp(6) with time zone,
        refunded_at timestamp(6) with time zone,
        updated_at timestamp(6) with time zone not null,
        version bigint,
        card_brand varchar(20),
        payment_method varchar(20),
        status varchar(20) not null check (status in ('CREATED','PROCESSING','SUCCESS','FAILED','REFUNDED')),
        customer_id varchar(36) not null,
        id varchar(36) not null,
        order_id varchar(36) not null,
        error_code varchar(50),
        gateway_response_code varchar(50),
        correlation_id varchar(64),
        idempotency_key varchar(64) not null unique,
        gateway_transaction_id varchar(100),
        refund_id varchar(100),
        error_message varchar(500),
        gateway_token varchar(255),
        refund_reason varchar(255),
        primary key (id)
    )
Hibernate: 
    create table payments (
        amount numeric(12,2) not null,
        attempt_count integer,
        card_last_four varchar(4),
        currency varchar(3) not null,
        refund_amount numeric(12,2),
        completed_at timestamp(6) with time zone,
        created_at timestamp(6) with time zone not null,
        processed_at timestamp(6) with time zone,
        refunded_at timestamp(6) with time zone,
        updated_at timestamp(6) with time zone not null,
        version bigint,
        card_brand varchar(20),
        payment_method varchar(20),
        status varchar(20) not null check (status in ('CREATED','PROCESSING','SUCCESS','FAILED','REFUNDED')),
        customer_id varchar(36) not null,
        id varchar(36) not null,
        order_id varchar(36) not null,
        error_code varchar(50),
        gateway_response_code varchar(50),
        correlation_id varchar(64),
        idempotency_key varchar(64) not null unique,
        gateway_transaction_id varchar(100),
        refund_id varchar(100),
        error_message varchar(500),
        gateway_token varchar(255),
        refund_reason varchar(255),
        primary key (id)
    )
2026-02-05 16:54:09.461 [main] [] DEBUG org.hibernate.SQL - 
    create index idx_payment_order_id 
       on payments (order_id)
Hibernate: 
    create index idx_payment_order_id 
       on payments (order_id)
2026-02-05 16:54:09.463 [main] [] DEBUG org.hibernate.SQL - 
    create index idx_payment_status 
       on payments (status)
Hibernate: 
    create index idx_payment_status 
       on payments (status)
2026-02-05 16:54:09.464 [main] [] DEBUG org.hibernate.SQL - 
    create index idx_payment_customer_id 
       on payments (customer_id)
Hibernate: 
    create index idx_payment_customer_id 
       on payments (customer_id)
2026-02-05 16:54:09.471 [main] [] INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-02-05 16:54:10.301 [main] [] INFO  o.s.d.j.r.query.QueryEnhancerFactory - Hibernate is in classpath; If applicable, HQL parser will be used.
2026-02-05 16:54:13.938 [main] [] INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 6 endpoint(s) beneath base path '/actuator'
2026-02-05 16:54:14.150 [main] [] WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-02-05 16:54:15.070 [main] [] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2f985057, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3809b1e6, org.springframework.security.web.context.SecurityContextHolderFilter@28056451, org.springframework.security.web.header.HeaderWriterFilter@6531c84, org.springframework.web.filter.CorsFilter@4e41fbf5, org.springframework.security.web.authentication.logout.LogoutFilter@3a4fccc7, org.springframework.security.oauth2.server.resource.web.authentication.BearerTokenAuthenticationFilter@2325b28f, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@69519536, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6da3dcc3, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@59302368, org.springframework.security.web.session.SessionManagementFilter@14d77224, org.springframework.security.web.access.ExceptionTranslationFilter@4a79c8cf, org.springframework.security.web.access.intercept.AuthorizationFilter@1312bde4]
2026-02-05 16:54:17.164 [main] [] INFO  o.s.c.n.e.c.DiscoveryClientOptionalArgsConfiguration - Eureka HTTP Client uses RestTemplate.
2026-02-05 16:54:17.298 [main] [] WARN  o.s.c.l.c.LoadBalancerCacheAutoConfiguration$LoadBalancerCaffeineWarnLogger - Spring Cloud LoadBalancer is currently working with the default cache. While this cache implementation is useful for development and tests, it's recommended to use Caffeine cache in production.You can switch to using Caffeine cache, by adding it and org.springframework.cache.caffeine.CaffeineCacheManager to the classpath.
2026-02-05 16:54:17.699 [main] [] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8082 (http) with context path ''
2026-02-05 16:54:17.776 [main] [] INFO  c.f.p.PaymentServiceApplication - Started PaymentServiceApplication in 23.854 seconds (process running for 26.414)
2026-02-05 16:54:17.811 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - Starting failed payments retry check...
2026-02-05 16:54:18.038 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
Hibernate: 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
2026-02-05 16:54:18.105 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - No failed payments eligible for retry
2026-02-05 16:54:18.125 [scheduling-1] [] ERROR o.s.s.s.TaskUtils$LoggingErrorHandler - Unexpected error occurred in scheduled task
org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'org.springframework.transaction.TransactionManager' available: expected single matching bean but found 2: transactionManager,kafkaTransactionManager
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1312)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:486)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:334)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.determineTransactionManager(TransactionAspectSupport.java:515)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:345)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.foodexpress.payment.scheduler.PaymentScheduledJobs$$SpringCGLIB$$0.markStuckPaymentsAsFailed(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
	at io.micrometer.observation.Observation.observe(Observation.java:499)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:358)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2026-02-05 16:54:19.218 [AsyncReporter{org.springframework.boot.actuate.autoconfigure.tracing.zipkin.ZipkinRestTemplateSender@7c6ab057}] [] WARN  z.r.AsyncReporter$BoundedAsyncReporter - Spans were dropped due to exceptions. All subsequent errors will be logged at FINE level.
2026-02-05 16:54:19.219 [AsyncReporter{org.springframework.boot.actuate.autoconfigure.tracing.zipkin.ZipkinRestTemplateSender@7c6ab057}] [] WARN  z.r.AsyncReporter$BoundedAsyncReporter - Dropped 2 spans due to ResourceAccessException(I/O error on POST request for "http://localhost:9411/api/v2/spans": Connect to http://localhost:9411 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused: getsockopt)
org.springframework.web.client.ResourceAccessException: I/O error on POST request for "http://localhost:9411/api/v2/spans": Connect to http://localhost:9411 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused: getsockopt
	at org.springframework.web.client.RestTemplate.createResourceAccessException(RestTemplate.java:905)
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:885)
	at org.springframework.web.client.RestTemplate.execute(RestTemplate.java:781)
	at org.springframework.web.client.RestTemplate.exchange(RestTemplate.java:663)
	at org.springframework.boot.actuate.autoconfigure.tracing.zipkin.ZipkinRestTemplateSender$RestTemplateHttpPostCall.doExecute(ZipkinRestTemplateSender.java:68)
	at org.springframework.boot.actuate.autoconfigure.tracing.zipkin.ZipkinRestTemplateSender$RestTemplateHttpPostCall.doExecute(ZipkinRestTemplateSender.java:48)
	at zipkin2.Call$Base.execute(Call.java:391)
	at zipkin2.reporter.AsyncReporter$BoundedAsyncReporter.flush(AsyncReporter.java:299)
	at zipkin2.reporter.AsyncReporter$Flusher.run(AsyncReporter.java:378)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.apache.hc.client5.http.HttpHostConnectException: Connect to http://localhost:9411 [localhost/127.0.0.1, localhost/0:0:0:0:0:0:0:1] failed: Connection refused: getsockopt
	at java.base/sun.nio.ch.Net.pollConnect(Native Method)
	at java.base/sun.nio.ch.Net.pollConnectNow(Net.java:682)
	at java.base/sun.nio.ch.NioSocketImpl.timedFinishConnect(NioSocketImpl.java:542)
	at java.base/sun.nio.ch.NioSocketImpl.connect(NioSocketImpl.java:592)
	at java.base/java.net.SocksSocketImpl.connect(SocksSocketImpl.java:327)
	at java.base/java.net.Socket.connect(Socket.java:751)
	at org.apache.hc.client5.http.socket.PlainConnectionSocketFactory.lambda$connectSocket$0(PlainConnectionSocketFactory.java:91)
	at java.base/java.security.AccessController.doPrivileged(AccessController.java:571)
	at org.apache.hc.client5.http.socket.PlainConnectionSocketFactory.connectSocket(PlainConnectionSocketFactory.java:90)
	at org.apache.hc.client5.http.socket.ConnectionSocketFactory.connectSocket(ConnectionSocketFactory.java:123)
	at org.apache.hc.client5.http.impl.io.DefaultHttpClientConnectionOperator.connect(DefaultHttpClientConnectionOperator.java:184)
	at org.apache.hc.client5.http.impl.io.PoolingHttpClientConnectionManager.connect(PoolingHttpClientConnectionManager.java:447)
	at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:162)
	at org.apache.hc.client5.http.impl.classic.InternalExecRuntime.connectEndpoint(InternalExecRuntime.java:172)
	at org.apache.hc.client5.http.impl.classic.ConnectExec.execute(ConnectExec.java:142)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.ProtocolExec.execute(ProtocolExec.java:192)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.HttpRequestRetryExec.execute(HttpRequestRetryExec.java:96)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.ContentCompressionExec.execute(ContentCompressionExec.java:152)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.RedirectExec.execute(RedirectExec.java:115)
	at org.apache.hc.client5.http.impl.classic.ExecChainElement.execute(ExecChainElement.java:51)
	at org.apache.hc.client5.http.impl.classic.InternalHttpClient.doExecute(InternalHttpClient.java:170)
	at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:87)
	at org.apache.hc.client5.http.impl.classic.CloseableHttpClient.execute(CloseableHttpClient.java:55)
	at org.apache.hc.client5.http.classic.HttpClient.executeOpen(HttpClient.java:183)
	at org.springframework.http.client.HttpComponentsClientHttpRequest.executeInternal(HttpComponentsClientHttpRequest.java:95)
	at org.springframework.http.client.AbstractStreamingClientHttpRequest.executeInternal(AbstractStreamingClientHttpRequest.java:70)
	at org.springframework.http.client.AbstractClientHttpRequest.execute(AbstractClientHttpRequest.java:66)
	at org.springframework.web.client.RestTemplate.doExecute(RestTemplate.java:879)
	... 8 common frames omitted
2026-02-05 16:59:18.136 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - Starting failed payments retry check...
2026-02-05 16:59:18.142 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
Hibernate: 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
2026-02-05 16:59:18.146 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - No failed payments eligible for retry
2026-02-05 17:00:00.043 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
Hibernate: 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
2026-02-05 17:00:00.111 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
Hibernate: 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
2026-02-05 17:00:00.121 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
Hibernate: 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
2026-02-05 17:00:00.130 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
Hibernate: 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
2026-02-05 17:00:00.135 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
Hibernate: 
    /* <criteria> */ select
        count(p1_0.id) 
    from
        payments p1_0 
    where
        p1_0.status=?
2026-02-05 17:00:00.140 [scheduling-1] [] INFO  c.f.p.scheduler.PaymentScheduledJobs - Payment Statistics - CREATED: 0, PROCESSING: 0, SUCCESS: 0, FAILED: 0, REFUNDED: 0
2026-02-05 17:04:18.150 [scheduling-1] [] ERROR o.s.s.s.TaskUtils$LoggingErrorHandler - Unexpected error occurred in scheduled task
org.springframework.beans.factory.NoUniqueBeanDefinitionException: No qualifying bean of type 'org.springframework.transaction.TransactionManager' available: expected single matching bean but found 2: transactionManager,kafkaTransactionManager
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveNamedBean(DefaultListableBeanFactory.java:1312)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveBean(DefaultListableBeanFactory.java:486)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:341)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.getBean(DefaultListableBeanFactory.java:334)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.determineTransactionManager(TransactionAspectSupport.java:515)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:345)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.foodexpress.payment.scheduler.PaymentScheduledJobs$$SpringCGLIB$$0.markStuckPaymentsAsFailed(<generated>)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.runInternal(ScheduledMethodRunnable.java:130)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.lambda$run$2(ScheduledMethodRunnable.java:124)
	at io.micrometer.observation.Observation.observe(Observation.java:499)
	at org.springframework.scheduling.support.ScheduledMethodRunnable.run(ScheduledMethodRunnable.java:124)
	at org.springframework.scheduling.support.DelegatingErrorHandlingRunnable.run(DelegatingErrorHandlingRunnable.java:54)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:572)
	at java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:358)
	at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2026-02-05 17:04:18.150 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - Starting failed payments retry check...
2026-02-05 17:04:18.158 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
Hibernate: 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
2026-02-05 17:04:18.163 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - No failed payments eligible for retry
2026-02-05 17:09:18.178 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - Starting failed payments retry check...
2026-02-05 17:09:18.189 [scheduling-1] [] DEBUG org.hibernate.SQL - 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
Hibernate: 
    /* SELECT
        p 
    FROM
        Payment p 
    WHERE
        p.status = 'FAILED' 
        AND p.attemptCount < :maxAttempts 
        AND p.updatedAt < :retryAfter 
    ORDER BY
        p.attemptCount ASC,
        p.updatedAt ASC */ select
            p1_0.id,
            p1_0.amount,
            p1_0.attempt_count,
            p1_0.card_brand,
            p1_0.card_last_four,
            p1_0.completed_at,
            p1_0.correlation_id,
            p1_0.created_at,
            p1_0.currency,
            p1_0.customer_id,
            p1_0.error_code,
            p1_0.error_message,
            p1_0.gateway_response_code,
            p1_0.gateway_token,
            p1_0.gateway_transaction_id,
            p1_0.idempotency_key,
            p1_0.order_id,
            p1_0.payment_method,
            p1_0.processed_at,
            p1_0.refund_amount,
            p1_0.refund_id,
            p1_0.refund_reason,
            p1_0.refunded_at,
            p1_0.status,
            p1_0.updated_at,
            p1_0.version 
        from
            payments p1_0 
        where
            p1_0.status='FAILED' 
            and p1_0.attempt_count<? 
            and p1_0.updated_at<? 
        order by
            p1_0.attempt_count,
            p1_0.updated_at
2026-02-05 17:09:18.193 [scheduling-1] [] DEBUG c.f.p.scheduler.PaymentScheduledJobs - No failed payments eligible for retry
